<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>DAQ View 2 React</title>

    <link rel="StyleSheet" href="dist/css/daqview.css" type="text/css"/>
    <link rel="StyleSheet" href="dist/css/components/fed-builder/fb-table.css" type="text/css"/>
    <link rel="StyleSheet" href="dist/css/components/filter-farm/fff-table.css" type="text/css"/>

    <script type="text/javascript" src="dist/lib/jquery/jquery-3.0.0.min.js"></script>
    <script type="text/javascript" src="dist/lib/classnames/index.js"></script>
    <script type="text/javascript" src="dist/lib/react/react.min.js"></script>
    <script type="text/javascript" src="dist/lib/react/react-dom.min.js"></script>

    <script type="text/javascript" src="dist/js/structures/daq-aggregator/da-snapshot.js"></script>
    <script type="text/javascript" src="dist/js/utilities/snapshot-provider.js"></script>
    <script type="text/javascript" src="dist/js/utilities/daqview-util.js"></script>
    <script type="text/javascript" src="dist/js/utilities/format-util.js"></script>
    <script type="text/javascript" src="dist/js/utilities/snapshot-randomizer.js"></script>
    <script type="text/javascript" src="dist/js/utilities/parser.js"></script>
    <script type="text/javascript" src="dist/js/components/fed-builder/fb-table.js"></script>
    <script type="text/javascript" src="dist/js/components/filter-farm/fff-table.js"></script>
   
    <script type="text/javascript" src="dist/js/daqview.js"></script>


    <script type="text/javascript">
        var daqView;
        $(document).ready(function () {
            try {
                daqView = new DAQView.DAQViewReact();
                daqView.createFBTable('daqview-react-fb-table');
                daqView.createFFFTable('daqview-react-fff-table');

                // HACK: to avoid browser errors when loading local JSON
                $.ajaxSetup({
                    beforeSend: function (xhr) {
                        if (xhr.overrideMimeType) {
                            xhr.overrideMimeType("application/json");
                        }
                    }
                });
				var parser = new DAQAggregator.SnapshotParser();
                var snapshotSource = {
                    updateInterval: 5000,
                    getSourceURL: function () {
                        return 'dist/json/1469177290765.ref.json'; // use local JSON
                       //return 'file:///afs/cern.ch/user/m/mvougiou/Desktop/tmp/snapshots/1469177290765.json';

                       /* var baseURL = 'http://dev-daq-expert.cern.ch/snapshot?time=';
                        var currentTime = new Date(new Date().getTime() - (10 * 24 * 3600 * 1000)).toISOString();

                        return baseURL + '"' + currentTime + '"';
                        */
                    },
                    parseSnapshot: (function (snapshot) {
                        console.log(snapshot);
                        snapshot = parser.parse.bind(parser)(snapshot);
                        //DAQAggregator.randomizeSnapshot(snapshot, 20);
                        console.log(snapshot);
                        return snapshot;
                    }).bind(window)
                };

                var snapshotProvider = new DAQAggregator.SnapshotProvider(snapshotSource);
                snapshotProvider.addView(daqView);
                snapshotProvider.start();

                /*
                 var snapshotSource = {
                 sourceUrl: 'http://localhost/snapshot',
                 updateInterval: 2000
                 };

                 // daqView.setSnapshotSource(snapshotSource);

                 var fedBuilder1ru = {
                 hostname: 'host-name',
                 isEVM: true,
                 errorMsg: '',
                 warnMsg: '',
                 infoMsg: '',

                 rate: 123.6,
                 throughput: 234.776,

                 superFragmentSizeMean: 243,
                 superFragmentSizeStddev: 5,

                 fragmentsInRU: 234234,
                 eventsInRU: 234234,
                 requests: 345092459
                 };

                 var fedBuilder1SubFedBuilders = [];

                 var fedBuilder1SubFedBuilder1FMM = {
                 geoslot: 6,
                 url: 'ffmurl:1234/test'
                 // missing feds?: FED[]
                 };

                 var fedBuilder1SubFedBuilder1TTCPartition = {
                 name: 'testTTCP',
                 ttsState: 'R',
                 percentWarning: 56,
                 percentBusy: 22,
                 fmm: fedBuilder1SubFedBuilder1FMM
                 };

                 var fedBuilder1SubFedBuilder1FrlPc = {
                 hostname: 'testfrlpc'
                 };

                 var fedBuilder1SubFedBuilder1 = {
                 minTrig: 234,
                 maxTrig: 564,
                 frlPc: fedBuilder1SubFedBuilder1FrlPc,
                 // missing? frls?: FRL[];
                 ttcPartition: fedBuilder1SubFedBuilder1TTCPartition
                 };

                 fedBuilder1SubFedBuilders.push(fedBuilder1SubFedBuilder1);

                 var fedBuilder1SubFedBuilder2FMM = {
                 geoslot: 4,
                 url: 'ffmurl:1234/test2'
                 // missing feds?: FED[]
                 };

                 var fedBuilder1SubFedBuilder2TTCPartition = {
                 name: 'test2TTCP',
                 ttsState: 'E',
                 percentWarning: 556,
                 percentBusy: 222,
                 fmm: fedBuilder1SubFedBuilder2FMM
                 };

                 var fedBuilder1SubFedBuilder2FrlPc = {
                 hostname: 'test2frlpc'
                 };

                 var fedBuilder1SubFedBuilder2 = {
                 minTrig: 2534,
                 maxTrig: 5654,
                 frlPc: fedBuilder1SubFedBuilder2FrlPc,
                 // missing? frls?: FRL[];
                 ttcPartition: fedBuilder1SubFedBuilder2TTCPartition
                 };

                 fedBuilder1SubFedBuilders.push(fedBuilder1SubFedBuilder2);

                 var fedBuilders = [];

                 var fedBuilder1 = {
                 name: 'Test FB',
                 ru: fedBuilder1ru,
                 subFedbuilders: fedBuilder1SubFedBuilders
                 };

                 fedBuilders.push(fedBuilder1);

                 var fedBuilderSummary = {
                 rate: 3535,
                 throughput: 35345,

                 superFragmentSizeMean: 3453,
                 superFragmentSizeStddev: 34,

                 deltaEvents: 3535,

                 sumFragmentsInRU: 35345,
                 sumEventsInRU: 35345,
                 sumRequests: 3455
                 };

                 var buSummary = {
                 rate: 234,
                 throughput: 3456,

                 eventSizeMean: 234,
                 eventSizeStddev: 5435,

                 numEvents: 3453,
                 numEventsInBU: 3453,

                 priority: 345,

                 numRequestsSent: 34535,
                 numRequestsUsed: 35345,
                 numRequestsBlocked: 3535,

                 numFUsHlt: 3535,
                 numFUsCrashed: 35,
                 numFUsStale: 35,
                 numFUsCloud: 35,

                 ramDiskUsage: 24,
                 ramDiskTotal: 24524552345234,
                 numFiles: 353,

                 numLumisectionsWithFiles: 3523,
                 currentLumisection: 34535,

                 numLumisectionsForHLT: 35345,
                 numLumisectionsOutHLT: 3535,

                 fuOutputBandwidthInMB: 35354
                 };

                 var bus = [];

                 var bu1 = {
                 hostname: 'bu-xzy2',

                 rate: 24,
                 throughput: 434,

                 eventSizeMean: 24234,
                 eventSizeStddev: 24,

                 numEvents: 44,
                 numEventsInBU: 2234,

                 priority: 423,

                 numRequestsSent: 44,
                 numRequestsUsed: 424,
                 numRequestsBlocked: 24234,

                 numFUsHlt: 234,
                 numFUsCrashed: 4,
                 numFUsStale: 55,
                 numFUsCloud: 35,

                 ramDiskUsage: 24234,
                 ramDiskTotal: 24524552345234,
                 numFiles: 244,

                 numLumisectionsWithFiles: 444,
                 currentLumisection: 234,

                 numLumisectionsForHLT: 55,
                 numLumisectionsOutHLT: 686,

                 fuOutputBandwidthInMB: 6786
                 };

                 bus.push(bu1);

                 var bu2 = {
                 hostname: 'bu-xzy44',

                 rate: 0,
                 throughput: 4345,

                 eventSizeMean: 247234,
                 eventSizeStddev: 924,

                 numEvents: 440,
                 numEventsInBU: 224534,

                 priority: 4253,

                 numRequestsSent: 454,
                 numRequestsUsed: 4424,
                 numRequestsBlocked: 242434,

                 numFUsHlt: 2344,
                 numFUsCrashed: 44,
                 numFUsStale: 545,
                 numFUsCloud: 353,

                 ramDiskUsage: 244234,
                 ramDiskTotal: 24524552345234,
                 numFiles: 2454,

                 numLumisectionsWithFiles: 4344,
                 currentLumisection: 2334,

                 numLumisectionsForHLT: 535,
                 numLumisectionsOutHLT: 6386,

                 fuOutputBandwidthInMB: 67286
                 };

                 bus.push(bu2);

                 var testSnapshot = new DAQAggregator.Snapshot({
                 fedBuilders: fedBuilders,
                 fedBuilderSummary: fedBuilderSummary,
                 buSummary: buSummary,
                 bus: bus
                 });

                 */
            }
            catch (exception) {
                console ? (console.debug ? console.debug(exception) : console.log(exception)) : alert(exception);
            }
        });
    </script>
</head>
<body>
<div id="daqview-react">
    <div id="daqview-react-fb-table"></div>
    <br/><br/>
    <div id="daqview-react-fff-table"></div>
</div>
</body>
</html>